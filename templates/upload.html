<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR & Entity Extraction</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-image: url('/static/images/bg.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 700px;
            padding: 30px;
            background-color: #EADDCA;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-size: 2.5rem;
            font-weight: bold;
            color: #343434;
            margin-bottom: 20px;
        }
        .form-group label {
            font-weight: 500;
            color: #343434;
        }
        .btn-primary, .btn-secondary, .btn-success {
            background-color: #6c757d;
            border: none;
            font-weight: 600;
            border-radius: 5px;
            padding: 10px 20px;
        }
        .btn-primary:hover, .btn-secondary:hover, .btn-success:hover {
            background-color: #5a6268;
        }
        #outputText {
            resize: none;
            background-color: #f0f4f8;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center">NER For Legal Documents</h1>

   <!-- Upload Section -->
<form action="/perform_ocr" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label for="file">Upload Document:</label> <!-- Ensure 'for' matches the 'id' -->
        <input type="file" name="file" id="file" required class="form-control-file" accept=".jpg, .jpeg, .png, .pdf, .docx">
    </div>
    
</form>


    <!-- OCR and Entity Extraction Buttons -->
    <div class="d-flex justify-content-between mt-3">
        <button type="button" class="btn btn-primary" id="ocrButton">Apply OCR</button>
    </div>

    <!-- Output Section -->
    <h3 class="mt-4">Extracted Text:</h3>
    <textarea class="form-control" id="outputText" placeholder="Text after performing OCR" rows="10" readonly></textarea>

    <!-- Save and Copy Buttons -->
    <div class="text-right mt-3">
        <button type="button" class="btn btn-success" id="saveTextButton">Save as Text File</button>
        <button type="button" class="btn btn-secondary" id="extractEntitiesButton">Extract Entities</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.1/tesseract.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    // Apply OCR
    document.getElementById("ocrButton").addEventListener("click", function () {
        let fileInput = document.getElementById("file").files[0];
        if (!fileInput) {
            alert("Please select a file to upload.");
            return;
        }
    
        let formData = new FormData();
        formData.append("file", fileInput);
    
        fetch("/perform_ocr", {
            method: "POST",
            body: formData,
        })
            .then((response) => {
                if (!response.ok) {
                    return response.json().then((error) => {
                        throw new Error(error.error || "Unknown server error");
                    });
                }
                return response.json();
            })
            .then((data) => {
                if (data.extracted_text) {
                    document.getElementById("outputText").value = data.extracted_text;
                } else {
                    document.getElementById("outputText").value = "No text extracted.";
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                alert("Error during OCR processing: " + error.message);
            });
    });
    

    // Save Extracted Text to File
    document.getElementById("saveTextButton").addEventListener("click", function() {
        let text = document.getElementById("outputText").value;
        let blob = new Blob([text], { type: "text/plain" });
        let url = window.URL.createObjectURL(blob);
        let a = document.createElement("a");
        a.href = url;
        a.download = "extracted_text.txt";
        a.click();
        window.URL.revokeObjectURL(url);
    });

    // Extract Entities
    
    document.getElementById("extractEntitiesButton").addEventListener("click", function () {
        let extractedText = document.getElementById("outputText").value.trim();  // Get text from textarea
    
        // Check if text is empty
        if (!extractedText) {
            alert("No text available to extract entities.");
            return;
        }
    
        // Prepare data to be sent to the server
        let data = JSON.stringify({ text: extractedText });
    
        fetch("/perform_entity_recognition", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",  // Set header to indicate JSON payload
            },
            body: data  // Send the extracted text
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.error || "Unknown server error");
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.entities) {
                alert("Entities Extracted:\n" + JSON.stringify(data.entities, null, 2));
            } else {
                alert("No entities extracted.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Error extracting entities: " + error.message);
        });
    });
    
    
</script>

</body>
</html>
